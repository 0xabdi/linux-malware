<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>linux-syscall-support - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><link rel="stylesheet" type="text/css" href="/+static/doc.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://chromium.googlesource.com/login/linux-syscall-support/">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">chromium</a> / <span class="Breadcrumbs-crumb">linux-syscall-support</span></div><h2 class="RepoDescription">Low level C API for making direct Linux syscalls.</h2><div class="CloneRepo"><div class="CloneRepo-title">Clone this repo:</div><input type="text" class="u-monospace CloneRepo-command" onclick="this.focus();if(this.selectionStart==this.selectionEnd){this.select()}" readonly="readonly" value="git clone https://chromium.googlesource.com/linux-syscall-support"></div><div class="RepoShortlog"><div class="RepoShortlog-refs"><div class="RefList RefList--responsive"><h3 class="RefList-title">Branches</h3><ul class="RefList-items"><li class="RefList-item"><a href="/linux-syscall-support/+/refs/heads/main">main</a></li><li class="RefList-item"><a href="/linux-syscall-support/+/refs/heads/master">master</a></li></ul></div><div class="RefList RefList--responsive"><h3 class="RefList-title">Tags</h3><ul class="RefList-items"><li class="RefList-item"><a href="/linux-syscall-support/+/refs/tags/v2021.04.12">v2021.04.12</a></li></ul></div></div><div class="RepoShortlog-log"><ol class="CommitLog"><li class="CommitLog-item CommitLog-item--chromiumOneline"><a class="u-sha1 u-monospace CommitLog-sha1" href="/linux-syscall-support/+/9719c1e1e676814c456b55f5f070eabad6709d31">9719c1e</a> <a href="/linux-syscall-support/+/9719c1e1e676814c456b55f5f070eabad6709d31">loongarch64:add $a7 to assembler constraints</a> <span class="CommitLog-author" title="mingtaoxt@gmail.com">by mingtaoxt xt</span> <span class="CommitLog-time" title="Wed Oct 12 05:43:22 2022">· 6 days ago</span> <a class="CommitLog-branchLabel" href="/linux-syscall-support/+/refs/heads/main">main</a></li><li class="CommitLog-item CommitLog-item--chromiumOneline"><a class="u-sha1 u-monospace CommitLog-sha1" href="/linux-syscall-support/+/b0fa15683b2a0ac339cfdb9c2eab7bf07311ee56">b0fa156</a> <a href="/linux-syscall-support/+/b0fa15683b2a0ac339cfdb9c2eab7bf07311ee56">Fixing typos</a> <span class="CommitLog-author" title="adeininger@urbanonline.de">by Andreas Deininger</span> <span class="CommitLog-time" title="Fri Sep 30 16:51:02 2022">· 2 weeks ago</span></li><li class="CommitLog-item CommitLog-item--chromiumOneline"><a class="u-sha1 u-monospace CommitLog-sha1" href="/linux-syscall-support/+/3159ddcbe26f13e293de0dfb3a701dc6559c4967">3159ddc</a> <a href="/linux-syscall-support/+/3159ddcbe26f13e293de0dfb3a701dc6559c4967">Update license boilerplate text in source code files</a> <span class="CommitLog-author" title="vapier@chromium.org">by Mike Frysinger</span> <span class="CommitLog-time" title="Wed Sep 07 18:49:35 2022">· 6 weeks ago</span></li><li class="CommitLog-item CommitLog-item--chromiumOneline"><a class="u-sha1 u-monospace CommitLog-sha1" href="/linux-syscall-support/+/ce877209e11aa69dcfffbd53ef90ea1d07136521">ce87720</a> <a href="/linux-syscall-support/+/ce877209e11aa69dcfffbd53ef90ea1d07136521">Fix yet more signedness conversion warnings.</a> <span class="CommitLog-author" title="pkasting@chromium.org">by Peter Kasting</span> <span class="CommitLog-time" title="Tue Aug 23 15:42:43 2022">· 8 weeks ago</span></li><li class="CommitLog-item CommitLog-item--chromiumOneline"><a class="u-sha1 u-monospace CommitLog-sha1" href="/linux-syscall-support/+/092a9214b587170d31477812e8effb025d4b8c99">092a921</a> <a href="/linux-syscall-support/+/092a9214b587170d31477812e8effb025d4b8c99">More narrowing failures, this time on ARM.</a> <span class="CommitLog-author" title="pkasting@chromium.org">by Peter Kasting</span> <span class="CommitLog-time" title="Mon Aug 22 21:07:05 2022">· 8 weeks ago</span></li></ol><nav class="LogNav"><a class="LogNav-next" href="/linux-syscall-support/+log">More &raquo;</a></nav><div class="doc RepoIndexDoc"><h1><a class="h" name="Linux-Syscall-Support-LSS" href="#Linux-Syscall-Support-LSS"><span></span></a><a class="h" name="linux-syscall-support-lss" href="#linux-syscall-support-lss"><span></span></a>Linux Syscall Support (LSS)</h1><p>Every so often, projects need to directly embed Linux system calls instead of calling the implementations in the system runtime library.</p><p>This project provides a header file that can be included into your application whenever you need to make direct system calls.</p><p>The goal is to provide an API that generally mirrors the standard C library while still making direct syscalls.  We try to hide some of the differences between arches when reasonably feasible.  e.g. Newer architectures no longer provide an <code class="code">open</code> syscall, but do provide <code class="code">openat</code>.  We will still expose a <code class="code">sys_open</code> helper by default that calls into <code class="code">openat</code> instead.</p><p>We explicitly do not expose the raw syscall ABI including all of its historical warts to the user.  We want people to be able to easily make a syscall, not have to worry that on some arches size args are swapped or they are shifted.</p><p>Please be sure to review the Caveats section below however.</p><h2><a class="h" name="How-to-include-linux_syscall_support_h-in-your-project" href="#How-to-include-linux_syscall_support_h-in-your-project"><span></span></a><a class="h" name="how-to-include-linux_syscall_support_h-in-your-project" href="#how-to-include-linux_syscall_support_h-in-your-project"><span></span></a>How to include linux_syscall_support.h in your project</h2><p>You can either copy the file into your project, or preferably, you can set up Git submodules to automatically pull from our source repository.</p><h2><a class="h" name="Supported-targets" href="#Supported-targets"><span></span></a><a class="h" name="supported-targets" href="#supported-targets"><span></span></a>Supported targets</h2><p>The following architectures/ABIs have been tested (at some point) and should generally work.  If you don&#39;t see your combo listed here, please double check the header itself as this list might be out of date.</p><ul><li>x86 32-bit (i.e. i386, i486, i586, i686, Intel, AMD, etc...)</li><li><a href="https://en.wikipedia.org/wiki/X86-64">x86_64 64-bit</a> (i.e. x86-64, amd64, etc...)</li><li><a href="https://sites.google.com/site/x32abi/">x32 32-bit</a></li><li><a href="https://en.wikipedia.org/wiki/ARM_architecture">ARM 32-bit</a> OABI</li><li><a href="https://en.wikipedia.org/wiki/ARM_architecture">ARM 32-bit</a> EABI (i.e. armv6, armv7, etc...)</li><li>AARCH64 64-bit (i.e. arm64, armv8, etc...)</li><li>PowerPC 32-bit (i.e. ppc, ppc32, etc...)</li><li>MIPS 32-bit o32 ABI</li><li>MIPS 32-bit n32 ABI</li><li>MIPS 64-bit n64 ABI</li><li>LOONGARCH 64-bit ABI</li></ul><h2><a class="h" name="API" href="#API"><span></span></a><a class="h" name="api" href="#api"><span></span></a>API</h2><p>By default, you can just add a <code class="code">sys_</code> prefix to any function you want to call. So if you want to call <code class="code">open(...)</code>, use <code class="code">sys_open(...)</code> instead.</p><h3><a class="h" name="Knobs" href="#Knobs"><span></span></a><a class="h" name="knobs" href="#knobs"><span></span></a>Knobs</h3><p>The linux_syscall_support.h header provides many knobs for you to control the exported API.  These are all documented in the top of the header in a big comment block, so refer to that instead.</p><h2><a class="h" name="Caveats" href="#Caveats"><span></span></a><a class="h" name="caveats" href="#caveats"><span></span></a>Caveats</h2><h3><a class="h" name="ABI-differences" href="#ABI-differences"><span></span></a><a class="h" name="abi-differences" href="#abi-differences"><span></span></a>ABI differences</h3><p>Some functions that the standard C library exposes use a different ABI than what the Linux kernel uses.  Care must be taken when making syscalls directly that you use the right structure and flags.  e.g. Most C libraries define a <code class="code">struct stat</code> (commonly in <code class="code">sys/stat.h</code> or <code class="code">bits/stat.h</code>) that is different from the <code class="code">struct stat</code> the kernel uses (commonly in <code class="code">asm/stat.h</code>).  If you use the wrong structure layout, then you can see errors like memory corruption or weird/shifted values.  If you plan on making syscalls directly, you should focus on headers that are available under the <code class="code">linux/</code> and <code class="code">asm/</code> namespaces.</p><p>Note: LSS provides structs for most of these cases.  For <code class="code">sys_stat()</code>, it provides <code class="code">struct kernel_stat</code> for you to use.</p><h3><a class="h" name="Transparent-backwards-compatibility-with-older-kernels" href="#Transparent-backwards-compatibility-with-older-kernels"><span></span></a><a class="h" name="transparent-backwards-compatibility-with-older-kernels" href="#transparent-backwards-compatibility-with-older-kernels"><span></span></a>Transparent backwards compatibility with older kernels</h3><p>While some C libraries (notably, glibc) take care to fallback to older syscalls when running on older kernels, there is no such support in LSS.  If you plan on trying to run on older kernels, you will need to handle errors yourself (e.g. <code class="code">ENOSYS</code> when using a too new syscall).</p><p>Remember that this can happen with new flag bits too.  e.g. The <code class="code">O_CLOEXEC</code> flag was added to many syscalls, but if you try to run use it on older kernels, it will fail with <code class="code">EINVAL</code>.  In that case, you must handle the fallback logic yourself.</p><h3><a class="h" name="Variable-arguments-varargs" href="#Variable-arguments-varargs"><span></span></a><a class="h" name="variable-arguments-varargs" href="#variable-arguments-varargs"><span></span></a>Variable arguments (varargs)</h3><p>We do not support vararg type functions.  e.g. While the standard <code class="code">open()</code> function can accept 2 or 3 arguments (with the mode field being optional), the <code class="code">sys_open()</code> function always requires 3 arguments.</p><h2><a class="h" name="Bug-reports-feature-requests" href="#Bug-reports-feature-requests"><span></span></a><a class="h" name="bug-reports-feature-requests" href="#bug-reports-feature-requests"><span></span></a>Bug reports &amp; feature requests</h2><p>If you wish to report a problem or request a feature, please file them in our <a href="https://bugs.chromium.org/p/linux-syscall-support/issues/">bug tracker</a>.</p><p>Please do not post patches to the tracker.  Instead, see below for how to send patches to us directly.</p><p>While we welcome feature requests, please keep in mind that it is unlikely that anyone will find time to implement them for you.  Sending patches is strongly preferred and will often move things much faster.</p><h2><a class="h" name="Projects-that-use-LSS" href="#Projects-that-use-LSS"><span></span></a><a class="h" name="projects-that-use-lss" href="#projects-that-use-lss"><span></span></a>Projects that use LSS</h2><ul><li><a href="https://www.chromium.org/">Chromium</a></li><li><a href="https://chromium.googlesource.com/breakpad/breakpad">Breakpad</a></li><li><a href="https://developer.chrome.com/native-client">Native Client</a>, in nacl_bootstrap.c</li></ul><h2><a class="h" name="How-to-get-an-LSS-change-committed" href="#How-to-get-an-LSS-change-committed"><span></span></a><a class="h" name="how-to-get-an-lss-change-committed" href="#how-to-get-an-lss-change-committed"><span></span></a>How to get an LSS change committed</h2><h3><a class="h" name="Review" href="#Review"><span></span></a><a class="h" name="review" href="#review"><span></span></a>Review</h3><p>You get your change reviewed, you can upload it to <a href="https://chromium-review.googlesource.com/q/project:linux-syscall-support+status:open">Gerrit</a> using <code class="code">git cl upload</code> from <a href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html">Chromium&#39;s depot-tools</a>.</p><h3><a class="h" name="Testing" href="#Testing"><span></span></a><a class="h" name="testing" href="#testing"><span></span></a>Testing</h3><p>Tests are found in the <a href="+/HEAD/tests">tests/</a> subdirectory.  It does not (yet) offer 100% coverage, but should grow over time.</p><p>New commits that update/change/add syscall wrappers should include tests for them too.  Consult the <a href="+/HEAD/tests/README.md">test documentation</a> for more details.</p><p>To run, just run <code class="code">make</code> inside the tests directory.  It will compile &amp; execute the tests locally.</p><p>There is some limited cross-compile coverage available if you run <code class="code">make cross</code>. It only compiles things (does not execute at all).</p><h3><a class="h" name="Rolling-into-Chromium" href="#Rolling-into-Chromium"><span></span></a><a class="h" name="rolling-into-chromium" href="#rolling-into-chromium"><span></span></a>Rolling into Chromium</h3><p>If you commit a change to LSS, please also commit a Chromium change to update <code class="code">lss_revision</code> in <a href="https://chromium.googlesource.com/chromium/src/+/HEAD/DEPS">Chromium&#39;s DEPS</a> file.</p><p>This ensures that the LSS change gets tested, so that people who commit later LSS changes don&#39;t run into problems with updating <code class="code">lss_revision</code>.</p></div></div></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>