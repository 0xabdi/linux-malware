<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">

<title>Tool Release &#8211; insject: A Linux Namespace Injector &#8211; NCC Group Research</title>
<script type="text/javascript">
  WebFontConfig = {"google":{"families":["PT+Sans:r:latin,latin-ext","PT+Sans:r,i,b,bi:latin,latin-ext"]}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://research.nccgroup.com/wp-content/mu-plugins/wpcomsh/vendor/automattic/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active code, .wf-active kbd, .wf-active pre, .wf-active samp{font-family:"PT Sans",sans-serif}.wf-active body{font-family:"PT Sans",sans-serif}.wf-active button, .wf-active input, .wf-active select{font-family:"PT Sans",sans-serif}.wf-active textarea{font-family:"PT Sans",sans-serif}.wf-active blockquote{font-family:"PT Sans",sans-serif}.wf-active code, .wf-active kbd, .wf-active pre, .wf-active tt, .wf-active var{font-family:"PT Sans",sans-serif}.wf-active .button, .wf-active .more-link, .wf-active button:not(.menu-toggle), .wf-active input[type="button"], .wf-active input[type="reset"], .wf-active input[type="submit"], .wf-active .posts-navigation .nav-links a, .wf-active #content #infinite-handle span button{font-family:"PT Sans",sans-serif}.wf-active input[type="email"], .wf-active input[type="password"], .wf-active input[type="search"], .wf-active input[type="text"], .wf-active input[type="url"], .wf-active textarea{font-family:"PT Sans",sans-serif}.wf-active .post-navigation{font-family:"PT Sans",sans-serif}.wf-active .main-navigation{font-family:"PT Sans",sans-serif}.wf-active .entry-content, .wf-active .entry-summary, .wf-active .page-content{font-family:"PT Sans",sans-serif}.wf-active .entry-content .subtitle{font-family:"PT Sans",sans-serif}.wf-active #comments{font-family:"PT Sans",sans-serif}.wf-active .comment-form label{font-family:"PT Sans",sans-serif}.wf-active .comment-form span.required{font-family:"PT Sans",sans-serif}.wf-active .widget_recent_entries span.post-date{font-family:"PT Sans",sans-serif}.wf-active .site-description{font-family:"PT Sans",sans-serif}.wf-active .site-posted-on time{font-family:"PT Sans",sans-serif}.wf-active .page-header:not(.page-header-light) .taxonomy-description{font-family:"PT Sans",sans-serif}.wf-active .light-text{font-family:"PT Sans",sans-serif}.wf-active .site-info{font-family:"PT Sans",sans-serif}.wf-active .sticky-label{font-family:"PT Sans",sans-serif}.wf-active .post-details, .wf-active .post-details a{font-family:"PT Sans",sans-serif}.wf-active .page-links{font-family:"PT Sans",sans-serif}.wf-active .post-edit-link{font-family:"PT Sans",sans-serif}.wf-active .post-author-card .author-description{font-family:"PT Sans",sans-serif}.wf-active #tinymce h1, .wf-active #tinymce h2, .wf-active #tinymce h3, .wf-active #tinymce h4, .wf-active #tinymce h5, .wf-active #tinymce h6, .wf-active .comment-content h1, .wf-active .comment-content h2, .wf-active .comment-content h3, .wf-active .comment-content h4, .wf-active .comment-content h5, .wf-active .comment-content h6, .wf-active .entry-content h1, .wf-active .entry-content h2, .wf-active .entry-content h3, .wf-active .entry-content h4, .wf-active .entry-content h5, .wf-active .entry-content h6, .wf-active .entry-summary h1, .wf-active .entry-summary h2, .wf-active .entry-summary h3, .wf-active .entry-summary h4, .wf-active .entry-summary h5, .wf-active .entry-summary h6, .wf-active .widget_text h1, .wf-active .widget_text h2, .wf-active .widget_text h3, .wf-active .widget_text h4, .wf-active .widget_text h5, .wf-active .widget_text h6{font-family:"PT Sans",sans-serif;font-style:normal;font-weight:400}.wf-active h1{font-style:normal;font-weight:400}.wf-active h2{font-style:normal;font-weight:400}.wf-active h3{font-style:normal;font-weight:400}.wf-active h4{font-style:normal;font-weight:400}.wf-active h5{font-style:normal;font-weight:400}.wf-active h6{font-style:normal;font-weight:400}.wf-active blockquote h1, .wf-active blockquote h2, .wf-active blockquote h3, .wf-active blockquote h4{font-family:"PT Sans",sans-serif;font-weight:400;font-style:normal}.wf-active div#jp-relatedposts h3.jp-relatedposts-headline em{font-family:"PT Sans",sans-serif;font-style:normal;font-weight:400}.wf-active .comment-reply-title, .wf-active .comments-title{font-family:"PT Sans",sans-serif;font-weight:400;font-style:normal}.wf-active .image-post-title{font-family:"PT Sans",sans-serif;font-weight:400;font-style:normal}.wf-active .page-header:not(.page-header-light) h1{font-style:normal;font-weight:400}.wf-active .entry-title{font-family:"PT Sans",sans-serif;font-style:normal;font-weight:400}.wf-active #post-cover-image .cover-meta .single-post-title{font-family:"PT Sans",sans-serif;font-style:normal;font-weight:400}.wf-active #hero-header .site-title{font-family:"PT Sans",sans-serif;font-style:normal;font-weight:400}.wf-active .site-header .site-title{font-style:normal;font-weight:400}.wf-active .site-header .site-description{font-style:normal;font-weight:400}</style>
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//secure.gravatar.com' />
<link rel='dns-prefetch' href='//widgets.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//0.gravatar.com' />
<link rel='dns-prefetch' href='//1.gravatar.com' />
<link rel='dns-prefetch' href='//2.gravatar.com' />
<link rel='dns-prefetch' href='//i0.wp.com' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link href='https://fonts.gstatic.com' crossorigin rel='preconnect' />
<link rel="alternate" type="application/rss+xml" title="NCC Group Research &raquo; Feed" href="https://research.nccgroup.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="NCC Group Research &raquo; Comments Feed" href="https://research.nccgroup.com/comments/feed/" />
<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/research.nccgroup.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.1.1"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode,e=(p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0),i.toDataURL());return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(p&&p.fillText)switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([129777,127995,8205,129778,127999],[129777,127995,8203,129778,127999])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(e=t.source||{}).concatemoji?c(e.concatemoji):e.wpemoji&&e.twemoji&&(c(e.twemoji),c(e.wpemoji)))}(window,document,window._wpemojiSettings);
</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css' href='https://research.nccgroup.com/wp-content/plugins/gutenberg/build/block-library/style.css?ver=14.5.2' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<link rel='stylesheet' id='wp-block-library-theme-css' href='https://research.nccgroup.com/wp-content/plugins/gutenberg/build/block-library/theme.css?ver=14.5.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-layout-grid-css' href='https://research.nccgroup.com/wp-content/plugins/layout-grid/style.css?ver=1643201242' type='text/css' media='all' />
<link rel='stylesheet' id='mediaelement-css' href='https://c0.wp.com/c/6.1.1/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css' href='https://c0.wp.com/c/6.1.1/wp-includes/js/mediaelement/wp-mediaelement.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='classic-theme-styles-css' href='https://c0.wp.com/c/6.1.1/wp-includes/css/classic-themes.min.css' type='text/css' media='all' />
<style id='global-styles-inline-css' type='text/css'>
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #fff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--color--medium-blue: #0087be;--wp--preset--color--bright-blue: #00aadc;--wp--preset--color--dark-gray: #4d4d4b;--wp--preset--color--light-gray: #b3b3b1;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;}:where(.is-layout-flex){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
</style>
<link rel='stylesheet' id='dashicons-css' href='https://c0.wp.com/c/6.1.1/wp-includes/css/dashicons.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-components-css' href='https://research.nccgroup.com/wp-content/plugins/gutenberg/build/components/style.css?ver=14.5.2' type='text/css' media='all' />
<link rel='stylesheet' id='godaddy-styles-css' href='https://research.nccgroup.com/wp-content/plugins/coblocks/includes/Dependencies/GoDaddy/Styles/build/latest.css?ver=1.0.5' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css' href='https://research.nccgroup.com/wp-content/plugins/jetpack/_inc/genericons/genericons/genericons.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='independent-publisher-2-style-css' href='https://research.nccgroup.com/wp-content/themes/independent-publisher-2/style.css?ver=6.1.1' type='text/css' media='all' />
<style id='independent-publisher-2-style-inline-css' type='text/css'>
.comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel='stylesheet' id='independent-publisher-2-block-style-css' href='https://research.nccgroup.com/wp-content/themes/independent-publisher-2/css/blocks.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='independent-publisher-2-wpcom-style-css' href='https://research.nccgroup.com/wp-content/themes/independent-publisher-2/inc/style-wpcom.css?ver=6.1.1' type='text/css' media='all' />
<style id='jetpack-global-styles-frontend-style-inline-css' type='text/css'>
:root { --font-headings: unset; --font-base: unset; --font-headings-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; --font-base-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;}
</style>
<link rel='stylesheet' id='social-logos-css' href='https://research.nccgroup.com/wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=11.6-a.5' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css' href='https://research.nccgroup.com/wp-content/plugins/jetpack/css/jetpack.css?ver=11.6-a.5' type='text/css' media='all' />
<script type='text/javascript' id='media-video-jwt-bridge-js-extra'>
/* <![CDATA[ */
var videopressAjax = {"ajaxUrl":"https:\/\/research.nccgroup.com\/wp-admin\/admin-ajax.php","bridgeUrl":"https:\/\/research.nccgroup.com\/wp-content\/plugins\/jetpack\/jetpack_vendor\/automattic\/jetpack-videopress\/src\/..\/build\/lib\/videopress-token-bridge.js","post_id":"14289"};
/* ]]> */
</script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/plugins/jetpack/jetpack_vendor/automattic/jetpack-videopress/src/../build/lib/videopress-token-bridge.js?ver=0.8.0' id='media-video-jwt-bridge-js'></script>
<link rel="https://api.w.org/" href="https://research.nccgroup.com/wp-json/" /><link rel="alternate" type="application/json" href="https://research.nccgroup.com/wp-json/wp/v2/posts/14289" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://research.nccgroup.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://research.nccgroup.com/wp-includes/wlwmanifest.xml" />

<link rel="canonical" href="https://research.nccgroup.com/2022/01/08/tool-release-insject-a-linux-namespace-injector/" />
<link rel='shortlink' href='https://wp.me/pbnf4R-3It' />
<link rel="alternate" type="application/json+oembed" href="https://research.nccgroup.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fresearch.nccgroup.com%2F2022%2F01%2F08%2Ftool-release-insject-a-linux-namespace-injector%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://research.nccgroup.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fresearch.nccgroup.com%2F2022%2F01%2F08%2Ftool-release-insject-a-linux-namespace-injector%2F&#038;format=xml" />
	<style>img#wpstats{display:none}</style>
		<meta name="description" content="Wait, setns(2) After execve(2) as root, Isn’t That Dangerous? Tremendously so." />
	<style id="independent-publisher-2-custom-header-css" type="text/css">
			.site-title,
		.site-description,
		#hero-header #hero-social-navigation {
			clip: rect(1px, 1px, 1px, 1px);
			position: absolute;
		}
		</style>
	<!-- There is no amphtml version available for this URL. -->			<style type="text/css">
				/* If html does not have either class, do not show lazy loaded images. */
				html:not( .jetpack-lazy-images-js-enabled ):not( .js ) .jetpack-lazy-image {
					display: none;
				}
			</style>
			<script>
				document.documentElement.classList.add(
					'jetpack-lazy-images-js-enabled'
				);
			</script>
		
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Tool Release &#8211; insject: A Linux Namespace Injector" />
<meta property="og:url" content="https://research.nccgroup.com/2022/01/08/tool-release-insject-a-linux-namespace-injector/" />
<meta property="og:description" content="Wait, setns(2) After execve(2) as root, Isn’t That Dangerous? Tremendously so. " />
<meta property="article:published_time" content="2022-01-08T05:20:06+00:00" />
<meta property="article:modified_time" content="2022-01-10T22:31:07+00:00" />
<meta property="og:site_name" content="NCC Group Research" />
<meta property="og:image" content="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2020/07/cropped-Gwl5Lrim_400x400-1.jpg?fit=512%2C512&#038;ssl=1" />
<meta property="og:image:width" content="512" />
<meta property="og:image:height" content="512" />
<meta property="og:image:alt" content="" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Tool Release &#8211; insject: A Linux Namespace Injector" />
<meta name="twitter:image" content="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2020/07/cropped-Gwl5Lrim_400x400-1.jpg?fit=240%2C240&amp;ssl=1" />
<meta name="twitter:card" content="summary" />

<!-- End Jetpack Open Graph Tags -->
<style type="text/css" id="custom-colors-css">.has-header-image .site-title a,.has-header-image .site-title a:visited{color:#fff}@media screen and (max-width:32.374em){.main-navigation ul ul{background:transparent !important}.main-navigation ul ul a{color:inherit !important}}.widget_recent_comments a,.widget_recent_entries a,body,input,select,textarea,.menu-toggle{color:#383838}#infinite-footer .blog-info a:hover,#infinite-footer .blog-credits a:hover{color:#383838}.posts-navigation .nav-links a,.main-navigation ul ul a,.main-navigation>div>ul>li.current-menu-item>ul>li a,.main-navigation>div>ul>li.current_page_item>ul>li a{color:#fff}input[type="button"],input[type="button"]:hover,input[type="reset"],input[type="reset"]:hover,input[type="submit"],input[type="submit"]:hover,button,.button,.button:hover,#content #infinite-handle span button,#content #infinite-handle span button:hover,.more-link,.more-link:hover,.more-link:visited{color:#fff}.site-main>.hentry:nth-child(n+2),.site .infinite-wrap>.hentry:nth-child(n+2),.entry-author-wrapper,.post-navigation,.comment,.page-links a:hover,.main-navigation li{border-color:#ddd}.site-main>.hentry:nth-child(n+2),.site .infinite-wrap>.hentry:nth-child(n+2),.entry-author-wrapper,.post-navigation,.comment,.page-links a:hover,.main-navigation li{border-color:rgba(221,221,221,.25)}#infinite-footer .blog-info a,#infinite-footer .blog-credits,#infinite-footer .blog-credits a{color:#6d6d6d}.post-details,.post-details a,.post-details a:visited,.post-edit-link a,.post-edit-link a:visited{color:#6e6e6c}.post-tags li:first-child,.jetpack-social-navigation li a:hover,.widget_wpcom_social_media_icons_widget li a:hover,.jetpack-social-navigation li a:focus,.widget_wpcom_social_media_icons_widget li a:focus,.jetpack-social-navigation li a:active,.widget_wpcom_social_media_icons_widget li a:active{color:#515151}.jetpack-social-navigation li a,.widget_wpcom_social_media_icons_widget li a{color:#6d6d6d}.post-navigation .nav-links a:hover,.post-navigation .nav-links a:focus,.post-navigation .nav-links a:active,.entry-author .author-bio,.site-posted-on time,.site-description{color:#6d6d6d}.comment .comment-meta,.comment-form label,.light-text,.light-text a,.light-text a:visited,.widget_rss .rss-date,.widget_rss li>cite{color:#6e6e6c}.light-text a:hover{color:#6e6e6c}body{background-color:#fff}#infinite-footer .container{background-color:#fff}#infinite-footer .container{background-color:rgba(255,255,255,.7)}.post-edit-link a{background-color:#f9f9f9}.entry-author .author-title,.entry-title,.entry-title a,.entry-title a:visited,.site-posted-on strong,.site-title,.site-title a,.site-title a:visited,.entry-title a:hover,.site-title a:hover,h1,h2,h3,h4,h5,h6,.page-header:not(.page-header-light) h1,.comment .comment-meta .comment-author .fn{color:#0a0a0a}.comment-form input[type="email"]:active,.comment-form input[type="email"]:focus,.comment-form input[type="password"]:active,.comment-form input[type="password"]:focus,.comment-form input[type="search"]:active,.comment-form input[type="search"]:focus,.comment-form input[type="text"]:active,.comment-form input[type="text"]:focus,.comment-form input[type="url"]:active,.comment-form input[type="url"]:focus,.comment-form textarea:active,.comment-form textarea:focus,blockquote,input[type="email"]:focus,input[type="password"]:focus,input[type="search"]:focus,input[type="text"]:focus,input[type="url"]:focus,textarea:focus{border-color:#b72520}.comment .comment-meta .comment-metadata a:hover,.comment-form span.required,.pingback:before,.post-details a:hover,.post-edit-link a:active,.post-edit-link a:focus,.post-edit-link a:hover,.site-info a:hover,.trackback:before,a,a:visited{color:#b72520}.main-navigation>div>ul>li.current-menu-item>a,.main-navigation>div>ul>li.current_page_item>a,a:active,a:focus,a:hover,.page-links a:hover{color:#b72520}.posts-navigation .nav-links a,.main-navigation ul ul{background-color:#b72520}button,input[type="button"],input[type="reset"],input[type="submit"],.button,#content #infinite-handle span button,.more-link{background-color:#b72520}button:not(".components-button"):hover,input[type="button"]:hover,input[type="reset"]:hover,input[type="submit"]:hover,.button:hover,#content #infinite-handle span button:hover,.more-link:hover{background-color:#8a1c18}</style>
<link rel="icon" href="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2020/07/cropped-Gwl5Lrim_400x400-1.jpg?fit=32%2C32&#038;ssl=1" sizes="32x32" />
<link rel="icon" href="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2020/07/cropped-Gwl5Lrim_400x400-1.jpg?fit=192%2C192&#038;ssl=1" sizes="192x192" />
<link rel="apple-touch-icon" href="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2020/07/cropped-Gwl5Lrim_400x400-1.jpg?fit=180%2C180&#038;ssl=1" />
<meta name="msapplication-TileImage" content="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2020/07/cropped-Gwl5Lrim_400x400-1.jpg?fit=270%2C270&#038;ssl=1" />
<style type="text/css" id="wp-custom-css">/*
/*--- Set main container max-width so logo and main nav aren't at the screen edge at larger screens / #15809476-hc ck ---*/
#page {
	max-width: 740px;
	margin: 0 auto;
	padding: 3.5em 1.75em 0;
}

@media screen and (min-width: 62em) {
	#page {
		box-sizing: border-box;
		max-width: 1080px;
		margin: 2.625em auto 0;
		padding: 0 1.75em;
	}
}

/*--- Align logo left / #15809476-hc ck ---*/
.site-hero-section {
	float: left;
	padding-left: 6em;
}

/*--- Align main nav right #15809476-hc ck ---*/
nav#site-navigation {
	float: right;
	width: auto;
	clear: none;
	padding-right: 6em;
}

/*--- Remove top margin from logo / #15809476-hc ck ---*/
header#masthead {
	margin-top: 0;
}

/*--- Avoid main content overlap logo and nav / #15809476-hc ck ---*/
div#content-wrapper {
	clear: both;
}

/*--- Hide static homepage title / #15809476-hc ck ---*/
.home h1.entry-title {
	display: none;
}</style></head>

<body class="post-template-default single single-post postid-14289 single-format-standard wp-custom-logo wp-embed-responsive group-blog custom-colors comment-hidden">

<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<div id="hero-header" class="site-hero-section">
		<header id="masthead" class="site-header" role="banner">
			<div class="inner">
				<div class="site-branding">
					<a href="https://research.nccgroup.com/" class="custom-logo-link" rel="home"><img width="180" height="50" src="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2019/11/small-ncc-group-logo-red.png?fit=180%2C50&amp;ssl=1" class="custom-logo jetpack-lazy-image" alt="NCC Group Research" decoding="async" data-attachment-id="277" data-permalink="https://research.nccgroup.com/small-ncc-group-logo-red/" data-orig-file="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2019/11/small-ncc-group-logo-red.png?fit=180%2C50&amp;ssl=1" data-orig-size="180,50" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="(Small NCC Group logo red" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2019/11/small-ncc-group-logo-red.png?fit=180%2C50&amp;ssl=1" data-large-file="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2019/11/small-ncc-group-logo-red.png?fit=180%2C50&amp;ssl=1" data-lazy-src="https://i0.wp.com/research.nccgroup.com/wp-content/uploads/2019/11/small-ncc-group-logo-red.png?fit=180%2C50&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" /></a>
												<p class="site-title"><a href="https://research.nccgroup.com/" rel="home">NCC Group Research</a></p>
													<p class="site-description">Making the world safer and more secure</p>
									</div><!-- .site-branding -->

				
									<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false" id="primary-menu-button">
						Menu					</button><!-- .menu-toggle -->
				
			</div><!-- .inner -->
		</header><!-- #masthead -->
	</div>

				<nav id="site-navigation" class="main-navigation" role="navigation">
			<div class="menu-home-container"><ul id="primary-menu" class="menu"><li id="menu-item-373" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-373"><a href="https://research.nccgroup.com/privacy-notice/">Privacy</a></li>
<li id="menu-item-227" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-227"><a href="https://nccgroup.wd3.myworkdayjobs.com/NCC_Group">Careers</a></li>
<li id="menu-item-8894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8894"><a href="https://research.nccgroup.com/disclosure-policy/">Disclosure Policy</a></li>
<li id="menu-item-449" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-449"><a href="https://research.nccgroup.com/category/technical-advisory/">Technical Advisories</a></li>
<li id="menu-item-12511" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12511"><a href="https://research.nccgroup.com/category/public-report/">Public Reports</a></li>
<li id="menu-item-14527" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-14527"><a href="https://research.nccgroup.com/2022/01/10/2021-annual-research-report/">2021 Research Report</a></li>
<li id="menu-item-5431" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5431"><a href="https://www.nccgroup.com/us/contact-us/"><button>Contact Us</button></a></li>
</ul></div>		</nav><!-- .main-navigation -->
	
	
	
	<div id="content-wrapper" class="content-wrapper">
		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-14289" class="post-14289 post type-post status-publish format-standard hentry category-research category-tool-release category-virtualization-emulation-containerization tag-containers tag-injection tag-ld_preload tag-linux-namespaces tag-tool-release tag-yolo">
			<header class="entry-header">
			<h1 class="entry-title">Tool Release &#8211; insject: A Linux Namespace Injector</h1>		</header><!-- .entry-header -->		<div class="entry-meta">
			<span class="byline">
				<a href="https://research.nccgroup.com/author/t94mbs12uxgqlgqtopb6hg/" title="Posts by Jeff Dileo" rel="author">Jeff Dileo</a>			</span>
							<span class="cat-links">
					<a href="https://research.nccgroup.com/category/research/" rel="category tag">Research</a>, <a href="https://research.nccgroup.com/category/tool-release/" rel="category tag">Tool Release</a>, <a href="https://research.nccgroup.com/category/research/virtualization-emulation-containerization/" rel="category tag">Virtualization, Emulation, &amp; Containerization</a>				</span><!-- .cat-links -->
			
			
			<span class="published-on">
				<time class="entry-date published" datetime="2022-01-08T05:20:06+00:00">January 8, 2022</time><time class="updated" datetime="2022-01-10T22:31:07+00:00">January 10, 2022</time>			</span>

			<span class="word-count">8 Minutes</span>		</div><!-- .entry-meta -->
	
	<div class="entry-content">
		
<p><strong><em>tl;dr</em></strong> Grab the release binary from <a href="https://github.com/nccgroup/insject">our repo</a> and have fun. Also, happy new year; 2021 couldn’t end soon enough.</p>
<h1 id="background">Background</h1>
<p>A while back, I was asked by one of my coworkers on the <a href="https://www.paysw.com/">PSC team</a> about ways in which to make their custom credit card data scanner cloud native to assess Kubernetes clusters. While the large quantity of advice and sympathy I offered them is out-of-scope for this post, the thought of such a tool got me thinking about ways to get external code running inside of running containers, especially read-only ones.</p>
<p>Note the phrase “external code,” as in code not already in a container image. This is the main problem that makes <code>nsenter</code> completely useless and an absolute headache to use; you can either run a binary from the container, or you can run your binary in every namespace of the container but the mount namespace. This is “fine” when all you want to do is some limited network namespace testing, but it’s a nonstarter when you want to grep across the filesystem that the container actually uses or interact with its actual procfs.</p>
<p>Obviously, outside of injecting code into a process already in a namespace, any implementation is going to involve <code>setns(2)</code>. The problem is that you need to somehow call <code>setns(2)</code> <em>after</em> the the <code>execve(2)</code> syscall, and ideally after the early init of the program being thrown into a foreign namespace.</p>
<h1 id="introducing-insject-your-friendly-neighhhhhamespace-injection-utility">Introducing insject, Your Friendly Neigh^H^H^H^Hamespace Injection Utility</h1>
<p>insject started out life as proof-of-concept C program and then an lldb script version. It is now a Rust program compiled into a dual shared library-executable; more on that later. insject’s primary feature is that it enables you to do all of your container attach fun <em>after</em> <code>execve(2)</code>-ing. Its secondary feature is the flexibility it offers in doing so.</p>
<p>insject is fundamentally an <code>LD_PRELOAD</code> library that uses <a href="https://github.com/frida/frida-gum/">libfrida-gum</a> to set up a hook on a configurable symbol/function/address/etc. (default <code>main()</code>) that, when hit, kicks off the container attach logic (including all of the <code>setns(2)</code> calls). This enables deferring the namespace attaches to basically whenever it is fine to do so. It also does a lot of work to hide its <code>LD_PRELOAD</code> environment variable from the process loaded with it to prevent it from being propagated to child processes; this is a major issue because shells such as Bash do a lot of wacky things with their environment variables.</p>
<p>As is par for the course, insject supports using arbitrary combinations of Linux namespaces based on process PIDs, uid:gid:groups, and AppArmor profiles (defaulting to the profile used by the target process). Additionally, insject supports controlling whether the userns <code>setns(2)</code> call happens before or after the other <code>setns(2)</code> calls, which can be occasionally useful. insject also supports (in LD_PRELOAD-based modes) <code>fork(2)</code>-ing after namespace joins when joining a PID namespace.</p>
<p>insject supports multiple methods of operation:</p>
<ul>
<li>shared library: LD_PRELOAD with CLI-style arguments in an environment variable</li>
<li>shared library: LD_PRELOAD with JSON-encoded configuration in an environment variable</li>
<li>executable: exec into target command with self as LD_PRELOADed shared library and JSON-encoded configuration environment variable</li>
<li>executable: remotely debug a target process into joining namespaces</li>
</ul>
<h2 id="thats-.so-executable">That’s .so executable</h2>
<p>So as to gain maximum compatibility without having to resort to tricks like <code>memfd_create(2)</code>, insject is built as a dual shared library-executable so that it may use its own path as an LD_PRELOAD target. Up until recently, such polyglot PIE executables were fairly standard affairs, but glibc in their infinite fatuity decided that such things should not be allowed to exist and on recent glibc versions, <code>dlopen(3)</code> will reject PIE executables. To get around this, we use the standard mechanism of removing the PIE flag from the executable because dynamically linked ELF executables <em>are</em> shared objects. However, due to this chicanery, there appear to be some weird edge cases with ld.so and/or Rust that result in the LD_PRELOAD execution environment being a bit finicky with such binaries, resulting in segfaults in seemingly non-<code>unsafe</code> code; so it’s very likely a glibc hubris bug.</p>
<p>Unfortunately, due to weird issues I’m still working out, debuggers seem to have issues with injecting these kinds of binaries into processes, so the remote debug mode is currently a C version of the insject payload packed into an lldb call expression.</p>
<p>The other oddity with the build is that Rust/cargo don’t really like linking arbitrary statically linked libraries (<code>.a</code> files) into shared libraries, which insject can be built as. And they also have all sorts of annoying issues with library lookup paths for such things, especially when compiling C as part of the build process, which insject intrinsically does due its dependence on <a href="https://github.com/ChaosData/frida-gum-rs">my binding wrapper</a> for frida-gum’s <code>gum_interceptor_attach</code> API, which relies on GLib-ified C. So I updated that crate to provide a <code>build.rs</code> macro to place a <code>.cargo/config</code> file with the necessary rustflags. Meanwhile, Rust is handing out CVEs for whitespace tricks, *tsk* *tsk*.</p>
<h1 id="usage">Usage</h1>
<p>The normal method of using insject is to just execute it, pass in the target PID, a <code>--</code> separator, and then whatever command you want to run against the target PID’s namespaces.</p>
<pre style="color:#839496;background-color:#002b36;font-size:10pt;font-family:'PT Mono', monospace;padding: 1rem;border-radius: 2px">$ ifconfig 
br-1a3c6b64c540: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        ether 02:42:b2:46:70:9a  txqueuelen 0  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        ether 02:42:bb:ee:b4:64  txqueuelen 0  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 26  bytes 5660 (5.6 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
...
$ sudo insject -S &lt;pid&gt; -- sh
[insject] -&gt; mnt: 0, net: 0, time: 0, ipc: 0, uts: 0, pid: 0, cgroup: 0, userns: -1, apparmor: docker-default, user: 0/0/0
# ifconfig
eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:02  
          inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:40 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:23261 (22.7 KiB)  TX bytes:0 (0.0 B)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
</pre>
<pre style="color:#839496;background-color:#002b36;font-size:10pt;font-family:'PT Mono', monospace;padding: 1rem;border-radius: 2px">$ sudo ./target/release/insject -S -s setns &lt;pid&gt; -- python3
Python 3.8.10 (default, Nov 26 2021, 20:14:08) 
[GCC 9.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; open("/etc/hostname","r").read()
'ubuntu\n'
&gt;&gt;&gt; import sys, os, ctypes, subprocess; libc = ctypes.CDLL('libc.so.6'); libc.setns(-1, -1)
[insject] -&gt; mnt: 0, net: 0, time: 0, ipc: 0, uts: 0, pid: 0, cgroup: 0, userns: -1, apparmor: docker-default, user: 0/0/0
-1
&gt;&gt;&gt; open("/etc/hostname","r").read()
'af40a9036a27\n'
</pre>
<h1 id="wait-setns2-after-execve2-as-root-isnt-that-dangerous">Wait, setns(2) After execve(2) as root, Isn’t That Dangerous?</h1>
<p>Tremendously so. There is a reason why insject sets the PID namespace towards the end. If it did so earlier, the target namespace could potentially <code>ptrace(2)</code> you before you finished leaving your namespace, and while you were still holding significant privileges. In fact, this is actually a fun way to enable cross-parent <code>ptrace(2)</code> support in contravention of <code>yama.ptrace_scope</code>; using user namespaces; you have the target join your user namespace that you have <code>CAP_SYS_PTRACE</code> in, and then you <code>ptrace(2)</code> it.</p>
<p>However, in practice, the real risk here is the file descriptors and the willingness of the binary you want to inject to load arbitrary code from the new mount namespace’s filesystem. This can be a big issue with Bash, which really likes to load shell scripts or with interpreters such as Python, which will prioritize local files in the directory (it thinks is) of the script being run over standard library modules, due to how <code>sys.path</code> works.</p>
<h2 id="a-short-list-of-things-not-to-do">A Short List of Things Not To Do</h2>
<ul>
<li>With a program that loads code from disk at runtime, attach to any normal container’s mount namespace without attaching to the PID namespace and forking (the default for PID ns attach)
<ul>
<li>If you don’t do both, you run the risk of loading code into a process that still has access to the host PID namespace and likely still has privileges there.</li>
</ul></li>
<li>With a program that loads code from disk at runtime and holds writable (or directory) file descriptors to host resources from before being insjected, attach to any normal container’s mount namespace
<ul>
<li>Doing so runs the risk of loading code that then uses the existing file descriptors to host namespace resources to manipulate them (so don’t do something like <code>open("/", 0)</code> before insjecting)</li>
</ul></li>
<li>Attach to the PID namespace of a container with CAP_SYS_PTRACE, but not other namespaces, especially the mount namespace
<ul>
<li>If you do this, even without pre-forking, subprocesses can be <code>ptrace(2)</code>-d by container processes via their PID and used to access host namespace resources</li>
</ul></li>
<li>With a program that holds writable (or directory) file descriptors to host resources from before being insjected, attach to a container with CAP_SYS_PTRACE
<ul>
<li>Similarly to the previous bullet, subprocesses or the fork child can be <code>ptrace(2)</code>-d by container processes via their PID and used to access the host namespace resources via their file descriptors.</li>
</ul></li>
<li>insject a program after it has created additional threads
<ul>
<li>As <code>setns(2)</code> only assigns a namespace to the calling thread, insjecting after a process has created threads will mean that the process will exist in a state where one of its threads will enter separate namespaces, while the others will remain in their original namespaces. This results in a similar risk profile as the previous situations as code execution in one thread can be trivially pivoted into another thread that can operate in the original namespaces. Additionally, <code>setns(2)</code> simply does not work with multithreaded programs for user namespaces and <a href="https://elixir.bootlin.com/linux/v5.15.13/source/kernel/time/namespace.c#L291">time namespaces</a>, though the latter behavior is undocumented. <code>setns(2)</code> will also not work if any threads have been created with the <code>clone(2)</code> <code>CLONE_FS</code> flag, which is used to ensure that <code>chdir(2)</code> and <code>umask(2)</code> syscalls are applied across threads; this flag is used for all Golang runtime threads, resulting in post-runtime init Go processes not being able to join mount namespaces, time namespaces, and user namespaces.</li>
</ul></li>
</ul>
<p>There are likely a large number of other dangerous combinations that arise from attaching to semi-privileged containers in specific ways, but they likely generally involve privileges that would enable container breakout anyway. However, your best bet is to use the <code>-S,--strict</code> flag, which will <code>exit(2)</code> the process if the insject operation occurs while the process has multiple threads, or if any part of the operation fails.</p>
<p>So be very careful. Like use <code>/bin/sh</code> (<code>dash</code>, <code>ash</code>, etc.), not <code>bash</code> or <code>zsh</code>, careful, especially if you have custom shell configurations/integrations like rvm. You have been warned. insject is available at <a href="https://github.com/nccgroup/insject" class="uri">https://github.com/nccgroup/insject</a>, have fun.</p>
<h1 id="conclusion">Conclusion</h1>
<p>This was a fun little toy to put together. insject is a fairly useful utility and solves most of the problems of setns, so I’m fairly happy with it. I will continue to try to find a good solution to the debugger problems, but it might have to involve a custom <code>ptrace(2)</code>-based code injector, which would potentially help with the other main limitation of LD_PRELOAD and <code>dlopen(3)</code>, they don’t really work from statically linked binaries.</p>
<p>Separately, while this isn’t my first time using Rust to build intricate LD_PRELOAD payloads, for all the annoyances involved, I would like to make it clear that Rust is still a great language to work with for these kinds of tasks since you have full access to its standard library and crate ecosystem.</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-14289" class="share-twitter sd-button share-icon" href="https://research.nccgroup.com/2022/01/08/tool-release-insject-a-linux-namespace-injector/?share=twitter" target="_blank" title="Click to share on Twitter" ><span>Twitter</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared="" class="share-reddit sd-button share-icon" href="https://research.nccgroup.com/2022/01/08/tool-release-insject-a-linux-namespace-injector/?share=reddit" target="_blank" title="Click to share on Reddit" ><span>Reddit</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-14289" class="share-linkedin sd-button share-icon" href="https://research.nccgroup.com/2022/01/08/tool-release-insject-a-linux-namespace-injector/?share=linkedin" target="_blank" title="Click to share on LinkedIn" ><span>LinkedIn</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-14289" class="share-facebook sd-button share-icon" href="https://research.nccgroup.com/2022/01/08/tool-release-insject-a-linux-namespace-injector/?share=facebook" target="_blank" title="Click to share on Facebook" ><span>Facebook</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-168079201-14289-637a1f7a7ba0f' data-src='https://widgets.wp.com/likes/#blog_id=168079201&amp;post_id=14289&amp;origin=research.nccgroup.com&amp;obj_id=168079201-14289-637a1f7a7ba0f' data-name='like-post-frame-168079201-14289-637a1f7a7ba0f' data-title='Like or Reblog'><h3 class="sd-title">Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>	</div><!-- .entry-content -->

	<div class="entry-footer">
		<ul class="post-tags light-text"><li>Tagged</li><li><a href="https://research.nccgroup.com/tag/containers/" rel="tag">Containers</a></li><li><a href="https://research.nccgroup.com/tag/injection/" rel="tag">injection</a></li><li><a href="https://research.nccgroup.com/tag/ld_preload/" rel="tag">LD_PRELOAD</a></li><li><a href="https://research.nccgroup.com/tag/linux-namespaces/" rel="tag">Linux namespaces</a></li><li><a href="https://research.nccgroup.com/tag/tool-release/" rel="tag">Tool Release</a></li><li><a href="https://research.nccgroup.com/tag/yolo/" rel="tag">yolo</a></li></ul><!-- .post-tags -->	</div><!-- .entry-footer -->

	<div class="entry-author-wrapper">
			<div class="entry-author">
		<div class="author-avatar">
			<img alt src="https://secure.gravatar.com/avatar/0b44bdc0b21050b06b0dcf367ef33c88?s=80&#038;d=identicon&#038;r=g" class="avatar avatar-80 photo jetpack-lazy-image" height="80" width="80" decoding="async" data-lazy-srcset="https://secure.gravatar.com/avatar/0b44bdc0b21050b06b0dcf367ef33c88?s=160&#038;d=identicon&#038;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/0b44bdc0b21050b06b0dcf367ef33c88?s=80&amp;is-pending-load=1#038;d=identicon&#038;r=g" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img data-lazy-fallback="1" alt='' src='https://secure.gravatar.com/avatar/0b44bdc0b21050b06b0dcf367ef33c88?s=80&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/0b44bdc0b21050b06b0dcf367ef33c88?s=160&#038;d=identicon&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' loading='lazy' decoding='async' /></noscript>		</div><!-- .author-avatar -->

		<div class="author-heading">
			<h2 class="author-title">
				Published by <span class="author-name">Jeff Dileo</span>			</h2>
		</div><!-- .author-heading -->

		<p class="author-bio">
						<a class="author-link" href="https://research.nccgroup.com/author/t94mbs12uxgqlgqtopb6hg/" rel="author">
				View all posts by Jeff Dileo			</a>
		</p><!-- .author-bio -->
	</div><!-- .entry-auhtor -->
			<div class="site-posted-on">
			<strong>Published</strong>
			<time class="entry-date published" datetime="2022-01-08T05:20:06+00:00">January 8, 2022</time><time class="updated" datetime="2022-01-10T22:31:07+00:00">January 10, 2022</time>		</div><!-- .site-posted-on -->
	</div>
</article><!-- #post-## -->

			
	<nav class="navigation post-navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://research.nccgroup.com/2022/01/03/detecting-anomalous-vectored-exception-handlers-on-windows/" rel="prev"><span class="meta-nav screen-reader-text">Previous Post</span> Detecting anomalous Vectored Exception Handlers on Windows</a></div><div class="nav-next"><a href="https://research.nccgroup.com/2022/01/10/2021-annual-research-report/" rel="next"><span class="meta-nav screen-reader-text">Next Post</span> NCC Group’s 2021 Annual Research Report</a></div></div>
	</nav>
			
		
		</main><!-- #main -->
	</div><!-- #primary -->

		</div><!-- #content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
						<div class="site-info">
				<a></a>
				
							</div><!-- .site-info -->
		</footer><!-- #colophon -->
	</div><!-- #content-wrapper -->
</div><!-- #page -->

<!--  -->
<script defer id="bilmur" data-provider="wordpress.com" data-service="atomic"  src="https://s0.wp.com/wp-content/js/bilmur.min.js?m=202246"></script>
	<div style="display:none">
			<div class="grofile-hash-map-0b44bdc0b21050b06b0dcf367ef33c88">
		</div>
		</div>
		
	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/research.nccgroup.com\/2022\/01\/08\/tool-release-insject-a-linux-namespace-injector\/":14289};
	</script>
				<script type='text/javascript' src='https://research.nccgroup.com/wp-content/plugins/jetpack/_inc/build/photon/photon.min.js?ver=20191001' id='jetpack-photon-js'></script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/plugins/coblocks/dist/js/coblocks-animation.js?ver=2.25.2' id='coblocks-animation-js'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=202246' id='grofiles-cards-js'></script>
<script type='text/javascript' id='wpgroho-js-extra'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/plugins/jetpack/modules/wpgroho.js?ver=11.6-a.5' id='wpgroho-js'></script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/themes/independent-publisher-2/js/navigation.js?ver=20170317' id='independent-publisher-2-navigation-js'></script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/themes/independent-publisher-2/js/independent-publisher-2.js?ver=20210118' id='independent-publisher-2-images-js'></script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/themes/independent-publisher-2/js/skip-link-focus-fix.js?ver=20170315' id='independent-publisher-2-skip-link-focus-fix-js'></script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/themes/independent-publisher-2/inc/script-wpcom.js?ver=20210111' id='independent-publisher-2-wpcom-functions-js'></script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/plugins/jetpack/jetpack_vendor/automattic/jetpack-lazy-images/dist/intersection-observer.js?minify=false&#038;ver=83ec8aa758f883d6da14' id='jetpack-lazy-images-polyfill-intersectionobserver-js'></script>
<script type='text/javascript' id='jetpack-lazy-images-js-extra'>
/* <![CDATA[ */
var jetpackLazyImagesL10n = {"loading_warning":"Images are still loading. Please cancel your print and try again."};
/* ]]> */
</script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/plugins/jetpack/jetpack_vendor/automattic/jetpack-lazy-images/dist/lazy-images.js?minify=false&#038;ver=8767d0da914b289bd862' id='jetpack-lazy-images-js'></script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/plugins/jetpack/_inc/build/likes/queuehandler.min.js?ver=11.6-a.5' id='jetpack_likes_queuehandler-js'></script>
<script type='text/javascript' id='sharing-js-js-extra'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://research.nccgroup.com/wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js?ver=11.6-a.5' id='sharing-js-js'></script>
<script type='text/javascript' id='sharing-js-js-after'>
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
</script>
	<iframe src='https://widgets.wp.com/likes/master.html?ver=202246#ver=202246' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
	<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
		<script src='https://stats.wp.com/e-202246.js' defer></script>
	<script>
		_stq = window._stq || [];
		_stq.push([ 'view', {v:'ext',blog:'168079201',post:'14289',tz:'0',srv:'research.nccgroup.com',hp:'atomic',ac:'2',amp:'0',j:'1:11.6-a.5'} ]);
		_stq.push([ 'clickTrackerInit', '168079201', '14289' ]);
	</script>
</body>
</html>
<!--
	generated in 0.201 seconds
	64819 bytes batcached for 300 seconds
-->
