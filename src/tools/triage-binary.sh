#!/bin/sh

FILENAME="${1}"

string_list () {
	filename="${1}"
	pattern="${2}"
	tactic="${3}"
	technique="${4}"
	strings "${filename}" | egrep "${pattern}" | sort | uniq -c | while read count symbol
	do
		printf "[%s: %s]: %s (%i)\n" "${tactic}" "${technique}" "${symbol}" "${count}"
	done
}

string_list "${FILENAME}" "arp |ifconfig |ping |nslookup " "Reconnaisance" "Gather Victim Network Information"
string_list "${FILENAME}" "\/resolv.conf|nslookup " "Reconnaisance" "DNS"
string_list "${FILENAME}" "python([ ]+|$)|Py_" "Execution" "Python"
string_list "${FILENAME}" "\.go\$" "Execution" "LM: Go"
string_list "${FILENAME}" "docker|podman|kubectl" "Execution" "Container Administration Command, Container Orchestration Job, Deploy Container"
string_list "${FILENAME}" "cron" "Execution" "Cron"
string_list "${FILENAME}" "systemctl " "Execution, Persistence, Discovery" "Systemd Timers, Systemd Service, System Service Discovery"
string_list "${FILENAME}" "\/bash|\/sh" "Execution" "Unix Shell"
string_list "${FILENAME}" "PATH" "Persistence" "Path Interception by PATH Environment Variable"
string_list "${FILENAME}" "\/ld\.so\.|LD_" "Persistence" "Dynamic Linker Hijacking"
string_list "${FILENAME}" "insmod |modprobe |init_module[@(]|\/proc\/ksym|\/dev\/kmem" "Persistence" "Kernel Modules and Extensions"
string_list "${FILENAME}" "\/\.ssh|authorized_keys" "Persistence" "SSH Authorized Keys"
string_list "${FILENAME}" "rc\.d|init\.d|\/\.profile|\/\.bash" "Persistence" "Boot or Logon Initialization Scripts"
string_list "${FILENAME}" "pam_" "Credential Access" "Pluggable Authentication Modules"
string_list "${FILENAME}" "\/passwd" "Credential Access" "Local Account, /etc/passwd and /etc/shadow"
string_list "${FILENAME}" "\/shadow" "Credential Access" "/etc/passwd and /etc/shadow"
string_list "${FILENAME}" "pcap_|tcpdump |tshark " "Credential Access" "Network Sniffing"
string_list "${FILENAME}" "history" "Credential Access, Defense Evasion" "Bash History, Clear Command History"
string_list "${FILENAME}" "\/\.ssh|id_[rd]sa" "Credential Access" "Private Keys"
string_list "${FILENAME}" "KRB5CCNAME|klist |kinit |\/var\/lib\/sss|\/tmp\/krb5cc" "Credential Access" "Steal or Forge Kerberos Tickets"
string_list "${FILENAME}" "gcc |g\+\+ " "Defense Evasion" "Compile After Delivery"
string_list "${FILENAME}" "iptables |ufw " "Defense Evasion" "Disable or Modify System Firewall"
string_list "${FILENAME}" "base64 |uudecode |uuencode " "Defense Evasion" "Data Obfuscation"
string_list "${FILENAME}" "tar |gzip |gunzip |zlib|gz|UPX Team" "Defense Evasion" "Software Packing"
string_list "${FILENAME}" "sudo |\/etc\/sudoers" "Defense Evasion" "Sudo and Sudo Caching"
string_list "${FILENAME}" "chmod" "Defense Evasion" "Setuid and Setgid, File and Directory Permissions Modification"
string_list "${FILENAME}" "ptrace[@(]" "Defense Evasion" "Ptrace System Calls, Debugger Evasion"
string_list "${FILENAME}" "mprotect[@(]" "Defense Evasion" "Process Hollowing"
string_list "${FILENAME}" "touch " "Defense Evasion" "Timestomp"
string_list "${FILENAME}" "\/var\/log" "Defense Evasion" "Clear Linux or Mac System Logs"
string_list "${FILENAME}" "rm |unlink[@(]" "Defense Evasion" "File Deletion"
string_list "${FILENAME}" "\/etc\/ssl" "Defense Evasion" "Install Root Certificate"
string_list "${FILENAME}" "memfd_" "Defense Evasion" "Reflective Code Loading"
string_list "${FILENAME}" "\/dev\/shm|\/tmp|\/var\/run|\/var\/tmp" "Defense Evasion" "LM: Non-persistant Storage"
string_list "${FILENAME}" "\/dev\/null" "Defense Evasion" "LM: Redirection To Null"
string_list "${FILENAME}" "argv|fork[@(]" "Defense Evasion" "LM: Process Tree Spoofing"
string_list "${FILENAME}" "ebpf" "Defense Evasion" "LM: EBPF Tracing"
string_list "${FILENAME}" "readdir[@(]|find [A-Za-z./]" "Discovery" "File and Directory Discovery"
string_list "${FILENAME}" "netstat |lsof" "Discovery" "Network Service Discovery"
string_list "${FILENAME}" "\/group" "Discovery" "Permission Groups Discovery"
string_list "${FILENAME}" "ps |\/proc" "Discovery" "Process Discovery"
string_list "${FILENAME}" "yum |apt-get |apt |rpm |dpkg " "Discovery" "Process Discovery"
string_list "${FILENAME}" "\/opt\/carbonblack|cbdaemon|cbsensor|\/opt\/sentinelone|\/opt\/CrowdStrike|falcond|falcon_" "Discovery" "Security Software Discovery"
string_list "${FILENAME}" "3389|xfreerdp |rdesktop " "Lateral Movement" "Remote Desktop Protocol"
string_list "${FILENAME}" "445|mount |smbclient |smb:" "Lateral Movement" "SMB/Windows Admin Shares"
string_list "${FILENAME}" "ssh |scp " "Lateral Movement" "SSH"
string_list "${FILENAME}" "tar " "Collection" "Archive Collected Data"
string_list "${FILENAME}" "\/etc|\/\.local|\/.git|\/.svn" "Collection" "Data from Local System"
string_list "${FILENAME}" "snmp" "Collection" "SNMP (MIB Dump)"
string_list "${FILENAME}" "bind[@(]|connect[@(]|listen[@(]|setsockopt[@(]" "Command and Control" "Traffic Signaling, Exfiltration Over Alternative Protocol"
string_list "${FILENAME}" "tls|ssl|https:\/\/" "Command and Control" "Encrypted Channel"
string_list "${FILENAME}" "http[s]_proxy" "Command and Control" "Proxy"
string_list "${FILENAME}" "http:\/\/|https:\/\/|curl |wget " "Command and Control" "Web Protocols, Exfiltration Over Web Service"
string_list "${FILENAME}" "ftp " "Command and Control" "File Transfer Protocols"
string_list "${FILENAME}" "\/www|\/public_html" "Impact" "Defacement"
string_list "${FILENAME}" "\/dev\/[sh]da[0-9]" "Impact" "Direct Volume Access, Disk Wipe"
